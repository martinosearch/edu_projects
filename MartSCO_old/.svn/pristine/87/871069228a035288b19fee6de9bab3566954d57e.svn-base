package jReports;

import java.io.File;
import java.io.IOException;
import java.io.InputStream;
import java.util.HashMap;
import java.util.Map;

import net.sf.jasperreports.engine.JRDataSource;
import net.sf.jasperreports.engine.JREmptyDataSource;
import net.sf.jasperreports.engine.JRException;
import net.sf.jasperreports.engine.JasperCompileManager;
import net.sf.jasperreports.engine.JasperExportManager;
import net.sf.jasperreports.engine.JasperFillManager;
import net.sf.jasperreports.engine.JasperPrint;
import net.sf.jasperreports.engine.JasperReport;
import net.sf.jasperreports.engine.design.JasperDesign;
import net.sf.jasperreports.engine.util.JRLoader;
import net.sf.jasperreports.engine.xml.JRXmlLoader;

public class test {

	public JasperReport compileReport(String jrxmlFileName) throws JRException,
			IOException {

		JasperReport jasperReport = null;

		InputStream jrxmlInput = JRLoader.getResourceInputStream(jrxmlFileName);

		String fileName = jrxmlFileName;
		try {
			fileName = getClass().getClassLoader().getResource(jrxmlFileName)
					.getFile();
		} catch (Exception e) {

		}
		System.out.println("nomFIchier: " + fileName);

		// if (jrxmlInput != null) {
		JasperDesign design = null;
		try {
			design = JRXmlLoader.load(fileName);
			System.out.println("nomFIchier: " + design);
		} catch (Exception e) {
			e.printStackTrace();
		} finally {
			// jrxmlInput.close();
		}
		jasperReport = JasperCompileManager.compileReport(design);
		// }

		return jasperReport;
	}

	public static void main(String[] args) {
		test t = new test();
		try {
			// File file = new File("result_bull.jrxml");
			// System.out.println("resultbull.jrxml exists:" + file.exists());

			JasperReport report = t
					.compileReport("jReports\\resultatbull.jrxml");

			// exportPDF(report);
			System.out.println("succes: " + report);

		} catch (JRException | IOException e) {
			e.printStackTrace();
		}
	}

	private static void exportPDF(JasperReport report) {
		System.out.println("reports: " + report);
		// Parameters for report
		Map<String, Object> parameters = new HashMap<String, Object>();
		parameters.put("Titre", "Titre");

		// DataSource
		// This is simple example, no database.
		// then using empty datasource.
		JRDataSource dataSource = new JREmptyDataSource();

		JasperPrint jasperPrint = null;

		try {
			jasperPrint = JasperFillManager.fillReport(report, parameters,
					dataSource);
		} catch (JRException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

		// Make sure the output directory exists.
		File outDir = new File("C:/jasperoutput");
		outDir.mkdirs();

		// Export to PDF.
		try {
			JasperExportManager.exportReportToPdfFile(jasperPrint,
					"C:/jasperoutput/StyledTextReport.pdf");
		} catch (JRException e) {
			e.printStackTrace();
		}

		System.out.println("Done!");
	}
}
